(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),document.removeEventListener("click",r)}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),document.addEventListener("click",r),document.querySelectorAll(".popup__input").forEach((function(e){e.classList.add("input-not-error")}))}function r(e){var n=document.querySelector(".popup_is-opened");e.target===n&&t(n)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}e.d({},{wg:()=>P,pc:()=>B,bj:()=>k,KM:()=>U,O9:()=>C,Vu:()=>j});var c=document.querySelector(".popup_confidence"),u=document.querySelector("#card-template").content;var i={baseUrl:"https://nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"0c97493c-ee07-4dd0-9f91-803e8ac0bd98","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s,d=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit"),_=document.querySelector(".profile__add-button"),m=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup__image"),h=document.querySelector(".popup__caption"),v=document.querySelectorAll(".popup__close"),b=document.querySelector(".popup__input_type_name"),S=document.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),g=(document.querySelectorAll(".popup__button"),document.forms["edit-profile"]),C=g.name,E=document.querySelector(".popup_confidence"),k=g.description,A=document.forms["new-place"],x=document.forms["form-avatar"],z=document.querySelector(".profile__image"),w=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),O=(document.querySelectorAll(".card__delete-button"),document.querySelector(".popup_avatar")),j=A["place-name"],U=A.link,P=x["place-avatar"],D=document.querySelector(".popup_type_image");function I(e){y.setAttribute("src",e.link),y.setAttribute("alt",e.name),h.textContent=e.name,n(D)}function M(e,t){e?t.textContent="Сохранение...":t.closest(".popup_type_new-card")?t.textContent="Создать":t.textContent="Сохранить"}function N(e,t,n){var r;e.target.classList.contains("card__like-button_is-active")||(r=t._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:i.headers}).then((function(e){return a(e)}))).then((function(t){n.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})),e.target.classList.contains("card__like-button_is-active")&&function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:i.headers.authorization}}).then((function(e){return a(e)}))}(t._id).then((function(t){n.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")}))}function B(e,n){(function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:i.headers.authorization}}).then((function(e){return a(e)}))})(e).then((function(){n.remove(),t(E)}))}g.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");M(!0,n),fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:i.headers.authorization,"Content-Type":i.headers["Content-Type"]},body:JSON.stringify({name:C.value,about:k.value})}).then((function(e){return a(e)})).then((function(){var e=document.querySelector(".profile__title"),t=document.querySelector(".profile__description");e.textContent=C.value,t.textContent=k.value})).catch((function(e){console.log(e)})).finally((function(){return M(!1,n)})).then((function(){t(f)}))})),A.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");M(!0,n),fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:{authorization:i.headers.authorization,"Content-Type":i.headers["Content-Type"]},body:JSON.stringify({name:j.value,link:U.value})}).then((function(e){return a(e)})).catch((function(e){console.log(e)})).finally((function(){return M(!1,n)})).then((function(){t(m)}))})),x.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");M(!0,n),fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:i.headers.authorization,"Content-Type":i.headers["Content-Type"]},body:JSON.stringify({avatar:P.value})}).then((function(e){return a(e)})).catch((function(e){console.log(e)})).finally((function(){return M(!1,n)})).then((function(){t(O)}))})),z.addEventListener("click",(function(){x.querySelector(".popup__button").setAttribute("disabled","true"),x.reset(),T.classList.remove("input-error"),T.classList.add("input-not-error"),document.querySelectorAll(".form__input-error_active").forEach((function(e){e.textContent=""})),n(O)})),p.addEventListener("click",(function(){b.value=q.textContent,S.value=L.textContent,document.querySelectorAll(".form__input-error_active").forEach((function(e){e.textContent=""})),n(f)})),_.addEventListener("click",(function(){A.querySelector(".popup__button").setAttribute("disabled","true"),A.reset(),w.classList.remove("input-error"),w.classList.add("input-not-error"),T.classList.remove("input-error"),T.classList.add("input-not-error"),document.querySelectorAll(".form__input-error_active").forEach((function(e){e.textContent=""})),n(m)})),v.forEach((function(e){var n=e.closest(".popup");e.addEventListener("click",(function(){t(n)}))})),s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(s.formSelector)).forEach((function(e){!function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.message):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="",t.classList.remove("input-error"),t.classList.add("input-not-error")}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass),t.classList.add("input-error"),t.classList.remove("input-not-error")}(e,t,t.validationMessage,n),function(e,t){for(var n=e.querySelectorAll(t.inputSelector),r=0;r<=n.length-1;r++){if(!n[r].validity.valid||""===n[r]){e.querySelector(t.submitButtonSelector).setAttribute("disabled","true");break}e.querySelector(t.submitButtonSelector).removeAttribute("disabled")}}(e,n)}(e,n,t)}))}))}(e,s)})),Promise.all([fetch("".concat(i.baseUrl,"/cards"),{headers:{authorization:i.headers.authorization}}).then((function(e){return a(e)})),fetch("".concat(i.baseUrl,"/users/me"),{headers:{authorization:i.headers.authorization}}).then((function(e){return a(e)}))]).then((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];q.textContent=a.name,L.textContent=a.about;var s=a._id;z.style.backgroundImage="url(".concat(a.avatar,")"),i.forEach((function(e){e.owner._id,e._id,d.append(function(e,t,r,o){var i=u.cloneNode(!0);i.querySelector(".card__title").textContent=e.name;var a=i.querySelector(".card__like-count");a.textContent=e.likes.length;var l=i.querySelector(".card__image"),s=i.querySelector(".card__delete-button");return e.likes.forEach((function(e){e._id===o&&i.querySelector(".card__like-button").classList.add("card__like-button_is-active")})),l.src=e.link,l.alt=e.name,o===e.owner._id?s.addEventListener("click",(function(){!function(e,t){n(c),document.querySelector(".popup__button-delete").addEventListener("click",(function(n){B(e._id,t.closest(".places__item"))}))}(e,s)})):s.remove(),i.querySelector(".card__like-button").addEventListener("click",(function(n){t(n,e,a)})),l.addEventListener("click",(function(){r(e)})),i}(e,N,I,s))}))}))})();