(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),document.removeEventListener("click",n)}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r),document.addEventListener("click",n),document.querySelectorAll(".form__input-error_active").forEach((function(t){t.textContent=""})),document.querySelectorAll(".popup__input").forEach((function(t){t.style.borderBottom="1px solid rgba(0, 0, 0, .2)"}))}function n(t){var o=document.querySelector(".popup_is-opened");t.target===o&&e(o)}function r(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}t.d({},{wg:()=>D,OP:()=>f,bj:()=>A,KM:()=>B,O9:()=>L,Vu:()=>P});var c="https://nomoreparties.co/v1/wff-cohort-2",u={authorization:"0c97493c-ee07-4dd0-9f91-803e8ac0bd98","Content-Type":"application/json"},a=document.querySelector(".popup_confidence");function i(t,e,o){var n;t.target.classList.contains("card__like-button_is-active")||(n=e._id,fetch("".concat(c,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:u.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")})),t.target.classList.contains("card__like-button_is-active")&&function(t){return fetch("".concat(c,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:u.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e._id).then((function(e){o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")}))}function l(t,o){(function(t){return fetch("".concat(c,"/cards/").concat(t),{method:"DELETE",headers:{authorization:u.authorization}}).then((function(t){if(t.ok)return t.json()}))})(t).then((function(){o.remove(),e(a)}))}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}document.querySelector(".popup");var d,p=document.querySelector(".places__list"),f=document.querySelector("#card-template").content,_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),S=document.querySelectorAll(".popup__close"),q=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=(document.querySelectorAll(".popup__button"),document.forms["edit-profile"]),L=C.name,A=C.description,x=document.forms["new-place"],j=document.forms["form-avatar"],z=document.querySelector(".profile__image"),T=document.querySelector(".popup__input_type_card-name"),O=document.querySelector(".popup__input_type_url"),w=(document.querySelectorAll(".card__delete-button"),document.querySelector(".popup_avatar")),P=x["place-name"],B=x.link,D=j["place-avatar"];function I(t){var e=document.querySelector(".popup_type_image");h.setAttribute("src",t.link),h.setAttribute("alt",t.name),b.textContent=t.name,o(e)}function M(t,e){e.textContent=t?"Сохранение...":"Сохранить"}C.addEventListener("submit",(function(t){t.preventDefault();var o=t.target.querySelector(".popup__button");M(!0,o),k.textContent=L.value,E.textContent=A.value,fetch("".concat(c,"/users/me"),{method:"PATCH",headers:{authorization:u.authorization,"Content-Type":u["Content-Type"]},body:JSON.stringify({name:L.value,about:A.value})}).finally((function(){return M(!1,o)})),e(m)})),x.addEventListener("submit",(function(t){t.preventDefault();var o=t.target.querySelector(".popup__button");M(!0,o),fetch("".concat(c,"/cards"),{method:"POST",headers:{authorization:u.authorization,"Content-Type":u["Content-Type"]},body:JSON.stringify({name:P.value,link:B.value})}).finally((function(){return M(!1,o)})),e(v)})),j.addEventListener("submit",(function(t){t.preventDefault();var o=t.target.querySelector(".popup__button");M(!0,o),fetch("".concat(c,"/users/me/avatar"),{method:"PATCH",headers:{authorization:u.authorization,"Content-Type":u["Content-Type"]},body:JSON.stringify({avatar:D.value})}).finally((function(){return M(!1,o)})),e(w)})),z.addEventListener("click",(function(){j.querySelector(".popup__button").setAttribute("disabled","true"),j.reset(),O.style.borderBottom="1px solid rgba(0, 0, 0, .2)",o(w)})),_.addEventListener("click",(function(){q.value=k.textContent,g.value=E.textContent,o(m)})),y.addEventListener("click",(function(){x.querySelector(".popup__button").setAttribute("disabled","true"),x.reset(),T.value="",O.value="",T.style.borderBottom="1px solid rgba(0, 0, 0, .2)",O.style.borderBottom="1px solid rgba(0, 0, 0, .2)",o(v)})),S.forEach((function(t){var o=t.closest(".popup");t.addEventListener("click",(function(){e(o)}))})),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(d.formSelector)).forEach((function(t){!function(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){o.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.message):e.setCustomValidity(""),e.validity.valid?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent="",e.style.borderBottom="1px solid rgba(0, 0, 0, .2)"}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass),e.style.borderBottom="1px solid #f00"}(t,e,e.validationMessage,o),function(t,e){for(var o=t.querySelectorAll(e.inputSelector),n=0;n<=o.length-1;n++){if(!o[n].validity.valid||""===o[n]){t.querySelector(e.submitButtonSelector).setAttribute("disabled","true");break}t.querySelector(e.submitButtonSelector).removeAttribute("disabled")}}(t,o)}(t,o,e)}))}))}(t,d)})),Promise.all([fetch("".concat(c,"/cards"),{headers:{authorization:u.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(c,"/users/me"),{headers:{authorization:u.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,u,a=[],i=!0,l=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(a.push(n.value),a.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(l)throw r}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?s(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],u=r[1];k.textContent=u.name,E.textContent=u.about;var a=u._id;z.style.backgroundImage="url(".concat(u.avatar,")"),c.forEach((function(t){var e=t.owner._id,n=t._id;p.append(function(t,e,n,r,c,u,a){var i=f.cloneNode(!0);i.querySelector(".card__title").textContent=t.name,i.querySelector(".card__like-count").textContent=t.likes.length;var l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__image"),d=document.querySelector(".popup_confidence"),p=i.querySelector(".card__like-count");return t.likes.forEach((function(t){t._id===c&&i.querySelector(".card__like-button").classList.add("card__like-button_is-active")})),s.src=t.link,s.alt=t.name,c===u?l.addEventListener("click",(function(){o(d),document.querySelector(".popup__button-delete").addEventListener("click",(function(t){e(a,l.closest(".places__item"))}))})):l.style.display="none",i.querySelector(".card__like-button").addEventListener("click",(function(e){n(e,t,p)})),s.addEventListener("click",(function(){r(t)})),i}(t,l,i,I,a,e,n))}))}))})();